using Telegram.Bot.Types;

namespace Witlesss.Commands.Messaging;

public class React : SyncCommand
{
    protected override void Run()
    {
        if (!Message.SenderIsBotAdmin())
        {
            Bot.SendMessage(Origin, FORBIDDEN.PickAny());
            return;
        }

        if (Args is null)
        {
            var manual =
                """
                <code>/re [message_url] [reaction]</code>

                Reactions: ğŸ‘ğŸ‘â¤ğŸ”¥ğŸ¥°ğŸ‘ğŸ˜ğŸ¤”ğŸ¤¯ğŸ˜±ğŸ¤¬ğŸ˜¢ğŸ‰ğŸ¤©ğŸ¤®ğŸ’©ğŸ™ğŸ‘ŒğŸ•ŠğŸ¤¡ğŸ¥±ğŸ¥´ğŸ˜ğŸ³â¤â€ğŸ”¥ğŸŒšğŸŒ­ğŸ’¯ğŸ¤£âš¡ğŸŒğŸ†ğŸ’”ğŸ¤¨ğŸ˜ğŸ“ğŸ¾ğŸ’‹ğŸ–•ğŸ˜ˆğŸ˜´ğŸ˜­ğŸ¤“ğŸ‘»ğŸ‘¨â€ğŸ’»ğŸ‘€ğŸƒğŸ™ˆğŸ˜‡ğŸ˜¨ğŸ¤âœğŸ¤—ğŸ«¡ğŸ…ğŸ„â˜ƒğŸ’…ğŸ¤ªğŸ—¿ğŸ†’ğŸ’˜ğŸ™‰ğŸ¦„ğŸ˜˜ğŸ’ŠğŸ™ŠğŸ˜ğŸ‘¾ğŸ¤·â€â™‚ğŸ¤·ğŸ¤·â€â™€ğŸ˜¡
                """;
            Bot.SendMessage(Origin, manual);
            return;
        }

        var args = Args.SplitN(3);
        var reaction = args.Length < 2
            ? null
            : new ReactionType[] { new ReactionTypeEmoji() { Emoji = args[1] } };

        var (chat, message) = args[0].GetChatIdAndMessage();

        Bot.ReactAsync(chat, message, reaction);
        Log($"REACTION >> {chat}", LogLevel.Info, LogColor.Yellow);
    }
}